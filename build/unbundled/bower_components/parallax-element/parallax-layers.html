<html><head><link rel="import" href="../polymer/polymer.html">

</head><body><dom-module id="parallax-layers">
  <template>
    <style>:host{-webkit-transform-style:preserve-3d;transform-style:preserve-3d;-webkit-transform:translateZ(0);-moz-transform:translateZ(0);-ms-transform:translateZ(0);-o-transform:translateZ(0);transform:translateZ(0);}:host > ::content > [depth]{position:absolute !important;-webkit-backface-visibility:hidden;-moz-backface-visibility:hidden;-ms-backface-visibility:hidden;backface-visibility:hidden;}:host > ::content > .fullbleed{top:0;right:0;bottom:0;left:0;}</style>
    <content id="layers"></content>
  </template>
  <script>Polymer({is:"parallax-layers",properties:{_horizontal:{type:Boolean,value:!1},_isObserving:{type:Boolean,value:!1},_parentSize:{type:Number,value:0},_perspective:{type:Number,value:1},_observer:{type:Object,value:null}},get layers(){return this.getEffectiveChildren()||Polymer.dom(this).children},render:function(t,e,s){this._perspective=t,this._parentSize=e,this._horizontal=s,this._prepare()},ready:function(){this._observer=new MutationObserver(function(t){var e=!1;t.forEach(function(t){if("parallax-layers"==t.target.localName||t.target.parentElement&&"parallax-layers"==t.target.parentElement.localName)return void(e=!0)}),e&&this._prepare()}.bind(this)),this._startObserving(),this._prepare()},detached:function(){this._stopObserving(),this._observer=null},_getDepth:function(t){var e=t.depth||t.getAttribute("depth")||0;return parseFloat(e)},_startObserving:function(){this._observer.observe(this,{childList:!0,attributes:!0,subtree:!0}),this._isObserving=!0},_stopObserving:function(){this._isObserving&&(this._isObserving=!1,this._observer.disconnect())},_prepare:function(){var t,e;if(this._stopObserving(),e=this.layers){t=this._horizontal?this.offsetWidth:this.offsetHeight,isHeader=0==(this._horizontal?this.offsetLeft:this.offsetTop);for(var s,r=0;s=e[r];r++)this._prepareLayer(s,t,isHeader)}this.async(function(){this._startObserving()})},_prepareLayer:function(t,e,s){var r=translateY=translateX=translateToStick=scale=0;t&&(depth=this._getDepth(t),r=depth*this._perspective,scale=1+(0!=this._perspective?-1*r/this._perspective:0),Polymer.dom(t).classList.remove(this._horizontal?"vertical":"horizontal"),Polymer.dom(t).classList.add(this._horizontal?"horizontal":"vertical"),translateToStick=this._prepareLayerOffsetAndPos(t,r,scale,e,s),translateY=this._horizontal?0:translateToStick,translateX=this._horizontal?translateToStick:0,t.style.transform=t.style.webkitTransform=0==depth?"":"scale("+scale+")"+(0!=translateX?" translateX("+translateX+"px)":"")+(0!=translateY?" translateY("+translateY+"px)":"")+(0!=r?" translateZ("+r+"px)":""))},_prepareLayerOffsetAndPos:function(t,e,s,r,i){var o=0,a=offsetBottom=centerTop=projectionFactor=speed=null,n=Polymer.dom(t).classList.contains("fullbleed");return 0!=this._perspective&&0!=e?(centerTop=(this._parentSize-r)/2,projectionFactor=1+1*e/(this._perspective-e),e<0?i?(o=this._parentSize/2,o-=r/2*s*projectionFactor,o=-(o-centerTop*projectionFactor)):n&&(speed=-1*e/(this._perspective-e),a=speed*(this._parentSize-r)/2,a=offsetBottom=-Math.ceil(a)):(speed=this._perspective/(1*(this._perspective-e))-1,i?(n&&(a=offsetBottom=-Math.ceil(speed*r/2)),o=-1*a+r/2*s*projectionFactor,o+=centerTop*projectionFactor,o-=this._parentSize/2):n&&(a=speed*((this._parentSize-r)/2+r),a=offsetBottom=-Math.ceil(a))),t.style.top=this._horizontal||null==a?"":a+"px",t.style.bottom=this._horizontal||null==offsetBottom?"":offsetBottom+"px",t.style.left=this._horizontal&&null!=a?a+"px":"",t.style.right=this._horizontal&&null!=offsetBottom?offsetBottom+"px":""):t.style.top=t.style.bottom=t.style.left=t.style.right="",o.toFixed(2)}});</script>
</dom-module></body></html>